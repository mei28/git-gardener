# 開発進捗記録

## TDD実装計画（t-wada流）

### 実装対象機能の優先順位

1. **cleanコマンド（最優先）** - 不要なworktreeの削除機能
2. **pull-allコマンド** - 並列処理でのgit pull実行
3. **config setコマンド** - 設定値の変更機能
4. **フック機構** - post_create等のフック実行

## Why-Why-Why分析

### なぜcleanコマンドを最優先で実装するのか？
1. **なぜ？** - worktreeの削除は手動で行うのが困難だから
2. **なぜ？** - git worktree removeコマンドを複数回実行する必要があり、ミスが起きやすいから
3. **なぜ？** - ディスク容量の無駄遣いとプロジェクト管理の混乱を避けるため

### なぜpull-allコマンドが次に重要なのか？
1. **なぜ？** - 複数worktreeの同期を効率化したいから
2. **なぜ？** - 手動で各worktreeでgit pullするのは時間がかかるから
3. **なぜ？** - 並列処理により開発者の待機時間を短縮するため

## 品質評価基準（5項目）での事前採点

### cleanコマンド実装
1. 目的適合性: 5点 - ユーザーの明確なニーズに対応
2. 技術的妥当性: 4点 - git2ライブラリを活用した適切な実装
3. ユーザー体験: 4点 - 安全な削除フローと確認機能
4. 運用可能性: 5点 - 実運用で必須の機能
5. 価値創造性: 4点 - 手動作業の自動化による効率向上

**総合スコア: 4.4/5 → 実装決定**

## TDDテストリスト

### cleanコマンド

#### 🔴 Red（失敗するテスト）
- [x] マージ済みブランチのworktreeを特定するテスト
- [ ] 古いworktreeを特定するテスト（最終コミット日時基準）
- [ ] 削除対象の表示テスト
- [ ] ユーザー確認後の削除実行テスト
- [ ] 削除失敗時のエラーハンドリングテスト

#### 🟢 Green（最小限の実装）
- [x] 仮実装：マージ済み判定機能実装
- [x] 三角測量：マージ済み・未マージ両パターンの対応
- [ ] 古いworktree判定の実装

#### 🔵 Refactor（リファクタリング）
- [x] マージ判定ロジックのcleanコマンドへの統合
- [ ] 削除ロジックの関数分割
- [ ] エラーハンドリングの統一

### pull-allコマンド

#### 🔴 Red（失敗するテスト）
- [ ] 複数worktreeでのgit pull実行テスト
- [ ] 並列処理の実行テスト
- [ ] pull失敗時のエラー報告テスト
- [ ] 進捗表示のテスト

#### 🟢 Green（最小限の実装）
- [ ] 仮実装：シーケンシャルなpull実行
- [ ] 仮実装：固定数の並列実行
- [ ] 三角測量：異なる並列度での実行

#### 🔵 Refactor（リファクタリング）
- [ ] 並列処理ライブラリの活用
- [ ] エラー収集機能の改善
- [ ] 進捗表示UIの向上

## 実装方針

### コミットルール（t-wada流）
- 🔴 テストを書いたら: `test: add failing test for [feature]`
- 🟢 テストを通したら: `feat: implement [feature] to pass test`
- 🔵 リファクタリングしたら: `refactor: [description]`

### 小刻みなコミット戦略
1. 一つのテストケース追加でコミット
2. そのテストを通す最小実装でコミット
3. リファクタリング完了でコミット

## 開発環境・ツール

### テスト実行コマンド
```bash
# 単体テスト実行
cargo test

# 特定のテスト実行
cargo test clean_command

# テストカバレッジ
cargo tarpaulin --out Html
```

### justfile活用
```just
# テスト実行とカバレッジ
test-with-coverage:
    cargo tarpaulin --out Html --output-dir coverage

# TDDサイクル実行
tdd feature:
    cargo test {{feature}} --lib
    cargo test {{feature}} --bin
```

## 実装時の注意事項

### エラーハンドリング
- ユーザーフレンドリーなエラーメッセージ
- 操作の取り消し機能
- ログ出力による問題調査支援

### パフォーマンス
- 大量のworktreeでも高速動作
- 適切な並列度の設定
- メモリ使用量の最適化

### セキュリティ
- 誤削除防止機能
- 権限チェック
- パス traversal攻撃対策

## 次回実装スケジュール

### Phase 1: cleanコマンド実装（今回）
- 期間: 1日
- 目標: 基本的な削除機能の完成

### Phase 2: pull-allコマンド実装
- 期間: 1日
- 目標: 並列処理によるpull機能の完成

### Phase 3: config setコマンド実装
- 期間: 0.5日
- 目標: 設定変更機能の完成

### Phase 4: フック機構実装
- 期間: 1日
- 目標: post_createフックの完成

## 学習・改善メモ

### 技術的発見
- （実装進行に伴って記録）

### 設計判断の理由
- （Why notの観点で記録）

### パフォーマンス測定結果
- （ベンチマーク結果を記録）